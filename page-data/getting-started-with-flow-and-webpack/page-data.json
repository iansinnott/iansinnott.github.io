{"componentChunkName":"component---src-templates-post-js","path":"/getting-started-with-flow-and-webpack/","result":{"data":{"post":{"canonicalURL":"https://blog.iansinnott.com/getting-started-with-flow-and-webpack/","content_html":"<p><span class=\"bold\">TL;DR:</span> This post will show you how to get set up with <a href=\"http://flowtype.org/\">Flow</a> and <a href=\"https://webpack.github.io/\">Webpack</a> as quickly as possible so that you can benefit from some degree of type safety in your JS code!</p>\n<h2>What are we talking about?</h2>\n<h3>Flow</h3>\n<p><a href=\"http://flowtype.org/\">Flow</a> is like ESLint on steroids. It is a static type checker for JavaScript. It let&#39;s you add types to any existing JS code. <span class=\"bold\">Why would you want to do this?</span>  The short answer is because JS ❤️ runtime errors, but runtime errors make your users sad. The more helpful answer is that Flow will analyze your codebase and catch bugs that may otherwise go unnoticed until you&#39;re app is already deployed to production. There is an entire site dedicated to explaining Flow, so I will let you check that out for more detailed information: http://flowtype.org/</p>\n<p>However, what may not be immediately obvious from the Flow site is the reason why it&#39;s so appealing for existing projects, which is that you can <span class=\"italic\">iterate</span> to full Flow coverage with minimal overhead.</p>\n<p>That means you can keep on hitting all your existing dev milestones while adding Flow type coverage to your code in parallel. Flow is also designed to work with <a href=\"http://babeljs.io/\">Babel</a>, so if you&#39;re already using Babel in your toolchain you&#39;ll be pleasantly surprised at how easy it is to set Flow up.</p>\n<h3>Webpack</h3>\n<p>If you&#39;re reading this post you probably already know what Webpack is, but just in case here&#39;s a two-sentence explanation: <span class=\"bold\">Webpack is a module bundler that lets you split your JS code into separate files that can </span><code class=\"bold\">import</code><span class=\"bold\"> or </span><code class=\"bold\">require</code><span class=\"bold\"> each other</span>, much like Require.js or Browserify. In addition, it also lets you import assets such as CSS files and images directly in your JavaScript files.</p>\n<p>In this post I&#39;m going to show you how you can get set up using Webpack with Flow, which might be a bit daunting at first since Flow doesn&#39;t support all of Webpack&#39;s features (such as CSS importing) out of the box.</p>\n<h2>Getting Set Up</h2>\n<pre>npm install -g flow-bin</pre>\n<p>That should be all you need to get the <code >flow</code> binary installed on your CLI.</p>\n<h3>Setting Up Webpack and Babel</h3>\n<p>This one will vary greatly depending on your projects, so I won&#39;t go over it here. What I will mention is that in order for Babel to properly compile Flow-typed code you will need to use the <a href=\"https://www.npmjs.com/package/babel%E2%B8%BBplugin%E2%B8%BBtransform%E2%B8%BBflow%E2%B8%BBstrip%E2%B8%BBtypes\">Babel Flow plugin</a>. If you&#39;re using <code >babel-plugin-react</code> then the Flow plugin should be included automatically.</p>\n<h2>Initial Flow Configuration</h2>\n<p>OK, here&#39;s the meat of this post. Once you have Flow installed and are in your projects root directory you will be ready to configure Flow. Let&#39;s do it.</p>\n<p><span class=\"bold\">Create a </span><code class=\"bold\">.flowconfig</code><span class=\"bold\"> file</span></p>\n<p>You can do this by running <code >flow init</code>.</p>\n<p>After running that command you should have a <code >.flowconfig</code> file in the current directory. Open up the file, since we will be editing it. You should see something like this initially:</p>\n<pre>[ignore]\n\n[include]\n\n[libs]\n\n[options]</pre>\n<p><span class=\"bold\">Test your configuation</span></p>\n<p>Run <code >flow</code> from the root directory where you just created <code >.flowconfig</code>. It will take a few seconds to run the first time, but every time after should be almost instant.</p>\n<p>You should see one of two things:</p>\n<ol><li><code >No errors!</code></li></ol>\n<ol><li>A bunch of errors</li></ol>\n<p>If you see a bunch of errors after just setting up Flow that is because Flow type-checks <span class=\"italic\">everything</span>, even all the code in your <code >node_modules</code>. Although it may be counter intuitive this is actually desired behavior, because Flow can warn you if you try to import anything that doesn&#39;t exist from <code >node_modules</code>.</p>\n<p>However, the downside is that when you first set up Flow you might see something like this:</p>\n<figure><img src=\"https://dropsinn.s3.amazonaws.com/Screen_Shot_2016-06-11_at_5_50_55_PM.png?table=block&id=\" alt=\"Flow Errors\"/><figcaption>Flow Errors</figcaption></figure>\n<p>In this example Flow is detecting type errors in the <code >fbjs</code> module, which is required by React. Getting past this issue is simple enough, simply add a new ignore line to <code >.flowconfig</code>. I have no idea how regex works in OCaml, but luckily there&#39;s no need. The Flow docs provide plenty of examples to show us how to ignore a certain directory. The syntax is <code >.*/path/to/dir/.*</code>. So to ignore everything under <code >node_modules/fbjs</code> you can update your <code >.flowconfig</code> as follows:</p>\n<pre>[ignore]\n.<span class=\"italic\">/node_modules/fbjs/.</span>\n\n[include]\n\n[libs]\n\n[options]</pre>\n<p>Since you haven&#39;t yet told Flow to type check any of your own code, every error you see is due to some third-party node module. That means its safe to ignore. Add more lines to the <code >[ignore]</code> section of <code >.flowconfig</code> until you&#39;ve successfully ignored any offending node modules.</p>\n<p>Now you should see <code >No errors!</code> on the command line when you run <code >flow</code>.</p>\n<p>Whew, time to move on to the fun part: Typing your own code!</p>\n<h2>Type checking our own code</h2>\n<p>To type check any of your js/jsx files with Flow simply add <code >/* @flow */</code> to the top of the file. This will make it visible to Flow. I would recommend doing this only one file at a time and fixing any errors that Flow catches in that file <span class=\"italic\">before</span> type-checking any new files. This strategy is simply meant to keep the number of errors from seeming overwhelming, since untyped code can often have a ton of errors.</p>\n<p>It is also worth noting that if the errors are so many that they seem daunting you can use <code >/* @flow weak */</code> to turn on a weaker type-checking mode in Flow that will likely produce fewer errors. Once you have all those errors handled you can revert back to <code >/* @flow */</code> and handle the more strict errors. Using Flow in it&#39;s most strict mode is how it was meant to be used, and will ultimately provide you with the most safety.</p>\n<h2>Advanced Configuration: CSS Modules, Image files, ES7, etc</h2>\n<h3>CSS Modules</h3>\n<p>All right, we made it to the Webpack specific part of this post. Let&#39;s talk about making CSS Modules type-check with Flow. If you&#39;re not using CSS Modules you can safely skip this section, but you may also want to [check them out][CSS Modules] since CSS Modules can be a big win for the maintainability of a codebase.</p>\n<p>Using CSS Modules with Webpack looks something like this:</p>\n<pre>import React from &#39;react&#39;;\nimport { render } from &#39;react-dom&#39;;\nimport s from &#39;./App.css&#39;; // CSS Modules!\n\nclass App extends React.Component {\n\trender() {\n\t\treturn (\n\t\t\t&lt;div className={s.App}&gt;\n\t\t\t\t&lt;h1&gt;My App&lt;/h1&gt;\n\t\t\t&lt;/div&gt;\n\t\t);\n\t}\n}\n\nrender(&lt;App /&gt;, document.getElementById(&#39;root&#39;));</pre>\n<p>The important part of that code is line 3, where we import <code >s</code> from a CSS file. Further down in the <code >render</code> method of <code >App</code> we see that <code >s</code> is expected to be a JavaScript object. However, Flow doesn&#39;t know this and it will complain as soon as it sees us trying to import a module named <code >App.css</code>. Flow will look for the <code >./App.css</code> JS module and find nothing, so it will throw an error:</p>\n<pre>src/components/App.js:3\n3: import s from &#39;./App.css&#39;;\n^^^^^^^^^^^ ./App.css. Required module not found</pre>\n<p>To solve this issue, we need to tell Flow to that for CSS files it should actually look for type definitions somewhere else. I&#39;ll describe how to do this briefly here, but there is also a good section on the Flow website that describes how to accomplish this: https://flowtype.org/docs/modules.html#css-modules-with-webpack</p>\n<p>Create a new directory named <code >flow</code> and a new file within that directory: <code >flow/CSSModule.js.flow</code>. Now add the following to <code >CSSModule.js.flow</code>:</p>\n<pre>// @flow\n\ndeclare export default { [key: string]: string }</pre>\n<p>When Flow reads this file it will see a default export of a plain JavaScript object that maps string keys to string values, which is exactly the case for CSS modules.</p>\n<p>The last step to make this work is to tell Flow which file extensions should use this <code >CSSModule.js.flow</code> file. We do that in the <code >[options]</code> section of our <code >.flowconfig</code>:</p>\n<pre>[ignore]\n.<span class=\"italic\">/node_modules/fbjs/.</span>\n\n[include]\n\n[libs]\n\n[options]\nmodule.name_mapper.extension=&#39;css&#39; -&gt; &#39;&lt;PROJECT_ROOT&gt;/flow/CSSModule.js.flow&#39;\nmodule.name_mapper.extension=&#39;styl&#39; -&gt; &#39;&lt;PROJECT_ROOT&gt;/flow/CSSModule.js.flow&#39;</pre>\n<p>The first line under <code >[options]</code> tells Flow that for every file with the <code >.css</code> extension it should read type info from the <code >CSSModule.js.flow</code> file we just created.</p>\n<p><span class=\"bold\">Note</span> that you can map multiple extensions in the options section. In my case, I use <a href=\"http://stylus%E2%B8%BBlang.com/\">Stylus</a> to author my CSS which means I needed to add the <code >.styl</code> extension as another filetype that should be interpreted as a CSS module. You can add support for Less and Sass in the same way.</p>\n<h3>Image Files</h3>\n<p>Since Webpack also lets you <code >import</code> image files we will want to add support for that as well. The process looks much the same as it did for CSS modules above: We need to create a new type definitions file that will be read for files with certain extensions. The only difference here is that our image files are imported as strings, not JavaScript objects as with CSS modules.</p>\n<p>Create another file: <code >flow/WebpackAsset.js.flow</code>. Now add the following to <code >WebpackAsset.js.flow</code>:</p>\n<pre>// @flow\n\ndeclare export default string</pre>\n<p>Then tell Flow about this file in your <code >.flowconfig</code>:</p>\n<pre>[ignore]\n.<span class=\"italic\">/node_modules/fbjs/.</span>\n\n[include]\n\n[libs]\n\n[options]\nmodule.name_mapper.extension=&#39;css&#39; -&gt; &#39;&lt;PROJECT_ROOT&gt;/flow/CSSModule.js.flow&#39;\nmodule.name_mapper.extension=&#39;styl&#39; -&gt; &#39;&lt;PROJECT_ROOT&gt;/flow/CSSModule.js.flow&#39;\nmodule.name_mapper.extension=&#39;png&#39; -&gt; &#39;&lt;PROJECT_ROOT&gt;/flow/WebpackAsset.js.flow&#39;\nmodule.name_mapper.extension=&#39;jpg&#39; -&gt; &#39;&lt;PROJECT_ROOT&gt;/flow/WebpackAsset.js.flow&#39;</pre>\n<p>In the above configuration file we tell Flow to use our <code >WebpackAsset.js.flow</code>\nfile in place of any file with a <code >.png</code> or <code >.jpg</code> extension.</p>\n<p>Now Flow will happily type code like this:</p>\n<pre>import React from &#39;react&#39;;\nimport { render } from &#39;react-dom&#39;;\nimport s from &#39;./App.css&#39;; // CSS Modules!\nimport logo from &#39;./logo.png&#39;; // Image Files!\n\nclass App extends React.Component {\n\trender() {\n\t\treturn (\n\t\t\t&lt;div className={s.App}&gt;\n\t\t\t\t&lt;h1&gt;My App&lt;/h1&gt;\n\t\t\t\t&lt;img src={logo} alt=&#39;App Logo&#39; /&gt;\n\t\t\t&lt;/div&gt;\n\t\t);\n\t}\n}\n\nrender(&lt;App /&gt;, document.getElementById(&#39;root&#39;));</pre>\n<p>Pretty slick, right? 😎</p>\n<p><span class=\"bold\">NOTE:</span> You will need to have the proper module loaders set up with Webpack\nfor this to even work in the first place</p>\n<h3>ES7 Class Support</h3>\n<p>If you&#39;re authoring React code you may well be interested in compile ES7-style\nclass syntax with babel. This things like <code >static propTypes = {}</code>,<code >state = {}</code>, etc. For example, here&#39;s a <code >Counter</code> component written using ES7 class\nsyntax:</p>\n<pre>import React from &#39;react&#39;;\n\nimport s from &#39;./Counter.css&#39;;\n\nclass Counter extends React.Component {\n\tstatic propTypes = {\n\t\tcolor: React.PropTypes.string,\n\t};\n\t\n\tstatic defaultProps = {\n\t\tinitialCount: 0,\n\t};\n\t\n\tstate = {\n\t\tcount: this.props.initialCount,\n\t};\n\t\n\tincrement = () =&gt; {\n\t\tthis.setState({ count: this.state.count + 1 })\n\t};\n\t\n\tdecrement = () =&gt; {\n\t\tthis.setState({ count: this.state.count - 1 })\n\t};\n\t\n\trender() {\n\t\treturn (\n\t\t\t&lt;div className={s.Counter}&gt;\n\t\t\t\t&lt;h1&gt;Count: {this.state.count}&lt;/h1&gt;\n\t\t\t\t&lt;div className={s.controls}&gt;\n\t\t\t\t\t&lt;button onClick={this.decrement}&gt;-&lt;/button&gt;\n\t\t\t\t\t&lt;button onClick={this.increment}&gt;+&lt;/button&gt;\n\t\t\t\t&lt;/div&gt;\n\t\t\t&lt;/div&gt;\n\t\t);\n\t}\n}</pre>\n<p>If you&#39;re not familiar with this syntax check out this blog post on the Babel\nwebsite: https://babeljs.io/blog/2015/06/07/react-on-es6-plus</p>\n<p><span class=\"bold\">NOTE:</span> At the time of this writing Flow requires semicolons after property\ninitializers in order to type check effectively, even though Babel does not\nrequire this.</p>\n<p>In order to allow code like that above we need to update the <code >[options]</code>\nsection of <code >.flowconfig</code> again:</p>\n<pre>[ignore]\n.<span class=\"italic\">/node_modules/fbjs/.</span>\n\n[include]\n\n[libs]\n\n[options]\nmodule.name_mapper.extension=&#39;css&#39; -&gt; &#39;&lt;PROJECT_ROOT&gt;/flow/CSSModule.js.flow&#39;\nmodule.name_mapper.extension=&#39;styl&#39; -&gt; &#39;&lt;PROJECT_ROOT&gt;/flow/CSSModule.js.flow&#39;\nmodule.name_mapper.extension=&#39;png&#39; -&gt; &#39;&lt;PROJECT_ROOT&gt;/flow/WebpackAsset.js.flow&#39;\nmodule.name_mapper.extension=&#39;jpg&#39; -&gt; &#39;&lt;PROJECT_ROOT&gt;/flow/WebpackAsset.js.flow&#39;\nesproposal.class_static_fields=enable\nesproposal.class_instance_fields=enable</pre>\n<p>We&#39;ve added two new lines to tell Flow we want to support this new class\nsyntax:</p>\n<pre>esproposal.class_static_fields=enable\nesproposal.class_instance_fields=enable</pre>\n<h3>Ignore Single Lines in Flow</h3>\n<p>The last Flow trick I&#39;ll show you today is how to tell Flow to ignore single lines in your code. Just like with ESLint, it can be useful to be able to ignore just one line in a file. There are usually two reasons you would want to do this:</p>\n<ol><li>The code in question needs to be refactored to be properly typed but it\nwould take too much time or effort to do it now</li></ol>\n<ol><li>Flow does not yet support some feature or has a bug</li></ol>\n<p>The first point is pretty obvious, but the second may come as a surprise. Flow is very advanced and very useful <span class=\"italic\">today</span> but it is not without its own bugs or missing features, so there may be times when you need to tell Flow to ignore a line for reason number two.</p>\n<p>The way to ignore single lines is by using the <code >supress_comment</code> option within your <code >.flowconfig</code>. Let&#39;s define two ignore patterns so that we can differentiate between the two types of reasons to ignore listed above:</p>\n<pre>suppress_comment=\\(.\\|\\n\\)<span class=\"italic\">\\$FlowFixMe\nsuppress_comment=\\(.\\|\\n\\)</span>\\$FlowIssue</pre>\n<p>Now anywhere in our code where we want Flow to ignore a line we can place a\ncomment on the proceeding line:</p>\n<pre>// $FlowFixMe: We aren&#39;t yet ready to refactor this line...\nfunction manyUntypedArgs(a, b, x, y) { /* ... */ }</pre>\n<h2>Conclusion</h2>\n<p>That&#39;s it! These are the tricks I&#39;ve found to be most useful in my day to day\nusage of Flow so far.</p>\n<p>Here&#39;s the full <code >.flowconfig</code> we created throughout this post for your\nreference:</p>\n<pre>[ignore]\n.<span class=\"italic\">/node_modules/fbjs/.</span>\n\n[include]\n\n[libs]\n\n[options]\nmodule.name_mapper.extension=&#39;css&#39; -&gt; &#39;&lt;PROJECT_ROOT&gt;/flow/CSSModule.js.flow&#39;\nmodule.name_mapper.extension=&#39;styl&#39; -&gt; &#39;&lt;PROJECT_ROOT&gt;/flow/CSSModule.js.flow&#39;\nmodule.name_mapper.extension=&#39;png&#39; -&gt; &#39;&lt;PROJECT_ROOT&gt;/flow/WebpackAsset.js.flow&#39;\nmodule.name_mapper.extension=&#39;jpg&#39; -&gt; &#39;&lt;PROJECT_ROOT&gt;/flow/WebpackAsset.js.flow&#39;\nesproposal.class_static_fields=enable\nesproposal.class_instance_fields=enable\nsuppress_comment=\\(.\\|\\n\\)<span class=\"italic\">\\$FlowFixMe\nsuppress_comment=\\(.\\|\\n\\)</span>\\$FlowIssue</pre>\n<p>You may have other options you need to make to your <code >.flowconfig</code>, such as\ndefining a directory for your <a href=\"https://flowtype.org/docs/declarations.html\">declaration files</a>. But hopefully this\nconfiguration helps get you started with Flow and Webpack! Big wins ahead.</p>\n<p>If you have any questions feel free to lave a comment below or <a href=\"https://twitter.com/ian_sinn\">hit me up on\ntwitter</a>.</p>","properties":{"tags":"javascript,flow,webpack","created":"2016-06-11T00:00:00.000Z","title":"Getting Started with Flow and Webpack","disqusId":null}}},"pageContext":{"id":"4a88ee86-bfe9-5560-9546-81bab3bd6620","prev":{"id":"3b96f38a-91b2-5cab-b03d-2a4c4803db0d","slug":"testing-webpack-plugins","properties":{"title":"Testing Webpack Plugins","created":"2016-05-11T00:00:00.000Z"}}}}}